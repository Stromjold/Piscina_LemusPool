<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Arzopa Aqua</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <link href="css/admin-arzopa.css" rel="stylesheet">
    <style>
    /* Estilos mínimos para el calendario */
    #calendarWrapper { max-width: 760px; margin-top: 1rem; }
    #calendarAdmin { display: grid; grid-template-columns: repeat(7, 1fr); gap: .35rem; }
    .calendar-day-header { font-weight: 700; text-align:center; padding: .5rem 0; background:#f8f9fa; border-radius:4px; }
    .calendar-admin-day { min-height: 80px; border: 1px solid #e9ecef; padding: .4rem .5rem; border-radius:6px; background:#fff; cursor:pointer; display:flex; flex-direction:column; justify-content:space-between; }
    .calendar-admin-day .day-number { font-weight:600; }
    .calendar-admin-day .day-status { font-size: .8rem; color:#6c757d; }
    .calendar-admin-day.occupied { background:#dc3545; color:#fff; }
    .calendar-admin-day.occupied .day-status { color: #fff; opacity: 0.95; }
    .calendar-admin-empty { border: none; background: transparent; }
    .calendar-controls { display:flex; align-items:center; gap:.5rem; margin-top: .75rem; }
    #calendarAdminTitle { font-weight:600; margin-right:auto; }
    @media (max-width:576px) { .calendar-admin-day { min-height:60px; } }
    </style>
</head>
<body>

    <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">Admin Arzopa Aqua</a>
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-nav">
            <div class="nav-item text-nowrap">
                <a class="nav-link px-3" href="#" data-site="arzopa" data-type="publica">Volver al Sitio</a>
            </div>
        </div>
    </header>

    <div class="container-fluid">
        <div class="row">
            
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#dashboard">
                                <i class="fas fa-home me-2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#calendario">
                                <i class="fas fa-calendar-alt me-2"></i> Gestionar Calendario
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#mensajes">
                                <i class="fas fa-envelope me-2"></i> Ver Mensajes
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#secciones">
                                <i class="fas fa-edit me-2"></i> Editar Secciones
                            </a>
                        </li>
                    </ul>
                    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>Cuenta</span>
                    </h6>
                    <ul class="nav flex-column mb-2">
                         <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-sign-out-alt me-2"></i> Cerrar Sesión
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                
                <section id="dashboard" class="pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Dashboard</h1>
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="card text-white bg-primary mb-3">
                                <div class="card-header">Reservas Pendientes</div>
                                <div class="card-body">
                                    <h5 class="card-title">3</h5>
                                    <p class="card-text">Reservas esperando confirmación.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-white bg-success mb-3">
                                <div class="card-header">Mensajes Nuevos</div>
                                <div class="card-body">
                                    <h5 class="card-title">5</h5>
                                    <p class="card-text">Mensajes no leídos de la web.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-dark bg-warning mb-3">
                                <div class="card-header">Días Ocupados (Este Mes)</div>
                                <div class="card-body">
                                    <h5 class="card-title">12</h5>
                                    <p class="card-text">Días marcados como no disponibles.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="calendario" class="pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Gestionar Calendario y Reservas</h1>
                    <p>Aquí puedes ver las reservas hechas desde el sitio y marcar días como "ocupados".</p>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">ID Reserva</th>
                                    <th scope="col">Nombre Cliente</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Fecha</th>
                                    <th scope="col">Estado</th>
                                    <th scope="col">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>#1024</td>
                                    <td>Juan Pérez</td>
                                    <td>juan.perez@email.com</td>
                                    <td>2025-11-15</td>
                                    <td><span class="badge bg-warning text-dark">Pendiente</span></td>
                                    <td>
                                        <button class="btn btn-success btn-sm" aria-label="Confirmar reserva"><i class="fas fa-check"></i></button>
                                        <button class="btn btn-danger btn-sm" aria-label="Rechazar reserva"><i class="fas fa-times"></i></button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>#1023</td>
                                    <td>Maria Gómez</td>
                                    <td>maria.gomez@email.com</td>
                                    <td>2025-11-12</td>
                                    <td><span class="badge bg-success">Confirmada</span></td>
                                    <td>
                                        <button class="btn btn-danger btn-sm" aria-label="Rechazar reserva"><i class="fas fa-times"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 class="h4 mt-4">Marcar Día como Ocupado</h3>
                    <form class="row g-3">
                        <div class="col-auto">
                          <label for="fechaOcupada" class="visually-hidden">Fecha</label>
                          <input type="date" class="form-control" id="fechaOcupada">
                        </div>
                        <div class="col-auto">
                          <button type="submit" class="btn btn-dark mb-3">Marcar Día</button>
                        </div>
                    </form>

                                        <!-- Calendario interactivo -->
                                        <div id="calendarWrapper">
                                                <div class="calendar-controls">
                                                        <button class="btn btn-outline-secondary btn-sm" onclick="changeCalendarMonth(-1)">«</button>
                                                        <div id="calendarAdminTitle">Noviembre 2025</div>
                                                        <button class="btn btn-outline-secondary btn-sm" onclick="changeCalendarMonth(1)">»</button>
                                                        <button class="btn btn-success btn-sm ms-2" onclick="saveCalendar()">Guardar</button>
                                                        <button class="btn btn-danger btn-sm ms-1" onclick="resetCalendar()">Restablecer</button>
                                                </div>
                                                <div id="calendarAdmin" class="mt-2"></div>
                                        </div>
                </section>

                <section id="mensajes" class="pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Mensajes de Contacto</h1>
                    <p>Mensajes recibidos desde el formulario de contacto.</p>
                    
                    <div class="accordion" id="accordionMensajes">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Mensajes de contacto recientes
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionMensajes">
                                <div class="accordion-body">
                                    <div id="contactMessagesList">
                                        <div class="mb-3">
                                            <strong>De:</strong> juan.perez@email.com (Tel: +56 9 1234 5678)
                                            <p><strong>Mensaje:</strong> Hola, quisiera saber si tienen disponibilidad para un evento corporativo el próximo mes. Gracias.</p>
                                        </div>
                                        <div class="mb-3">
                                            <strong>De:</strong> maria.gomez@email.com (Tel: +56 9 8765 4321)
                                            <p><strong>Mensaje:</strong> ¿Cuáles son los horarios de fin de semana?</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Solicitudes de restablecimiento -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingReset">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReset" aria-expanded="false" aria-controls="collapseReset">
                                    Solicitudes de Restablecimiento de Contraseña
                                </button>
                            </h2>
                            <div id="collapseReset" class="accordion-collapse collapse" aria-labelledby="headingReset" data-bs-parent="#accordionMensajes">
                                <div class="accordion-body">
                                    <p>A continuación aparecen las solicitudes enviadas por los usuarios. Puedes restablecer la contraseña manualmente desde aquí.</p>
                                    <div id="passwordResetRequestsList" class="list-group">
                                        <!-- Renderizado por JS -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="secciones" class="pt-3 pb-2 mb-3">
                    <h1 class="h2">Editar Contenido de la Página</h1>
                    
                    <div class="card my-4">
                        <div class="card-header">
                            Sección 1: Toboganes y Diversión
                        </div>
                        <div class="card-body">
                            <form>
                                <div class="mb-3">
                                    <label for="s1-titulo" class="form-label">Título</label>
                                    <input type="text" class="form-control" id="s1-titulo" value="Toboganes y Diversión">
                                </div>
                                <div class="mb-3">
                                    <label for="s1-p1" class="form-label">Párrafo Principal (lead)</label>
                                    <textarea class="form-control" id="s1-p1" rows="3">¡La fiesta no es solo de noche! En Arzopa Aqua, el día se llena de adrenalina y risas. Deslízate por nuestros increíbles toboganes acuáticos y sumérgete en la mejor pool party de la ciudad.</textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="s1-p2" class="form-label">Párrafo Secundario</label>
                                    <textarea class="form-control" id="s1-p2" rows="2">Combina la emoción de un parque acuático con el lujo de un club VIP. Música, sol y pura diversión te esperan en cada rincón.</textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="s1-img" class="form-label">URL de Imagen</label>
                                    <input type="text" class="form-control" id="s1-img" value="https://www.vortex-intl.com/wp-content/uploads/2020/10/drop-slides.png">
                                </div>
                                <button type="submit" class="btn btn-primary">Guardar Cambios (Sección 1)</button>
                            </form>
                        </div>
                    </div>

                    <div class="card my-4">
                        <div class="card-header">
                            Sección 2: Piscinas para la Familia
                        </div>
                        <div class="card-body">
                            <form>
                                <div class="mb-3">
                                    <label for="s2-titulo" class="form-label">Título</label>
                                    <input type="text" class="form-control" id="s2-titulo" value="Piscinas para la Familia">
                                </div>
                                <div class="mb-3">
                                    <label for="s2-p1" class="form-label">Párrafo Principal (lead)</label>
                                    <textarea class="form-control" id="s2-p1" rows="3">Praesent eu massa vel diam laoreet elementum. Sed sit amet nagy, consectetur adipiscing elit. Nulla convallis, erat nec iaculis finibus, erat massa commodo erat.</textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="s2-img" class="form-label">URL de Imagen</label>
                                    <input type="text" class="form-control" id="s2-img" value="https://www.fmdos.cl/wp-content/uploads/2024/01/Parque-acuatico-Santiago-3-jpg.webp">
                                </div>
                                <button type="submit" class="btn btn-primary">Guardar Cambios (Sección 2)</button>
                            </form>
                        </div>
                    </div>

                    <div class="card my-4">
                        <div class="card-header">
                            Sección 3: Relajo y Naturaleza
                        </div>
                        <div class="card-body">
                            <form>
                                <div class="mb-3">
                                    <label for="s3-titulo" class="form-label">Título</label>
                                    <input type="text" class="form-control" id="s3-titulo" value="Relajo y Naturaleza">
                                </div>
                                <div class="mb-3">
                                    <label for="s3-p1" class="form-label">Párrafo Principal (lead)</label>
                                    <textarea class="form-control" id="s3-p1" rows="3">Donec et ex pleacerat, sollicitudin eros eget, euismod risus. Praesent eu massa vel diam laoreet elementum. Sed sit amet nagy, consectetur adipiscing elit.</textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="s3-img" class="form-label">URL de Imagen</label>
                                    <input type="text" class="form-control" id="s3-img" value="https://www.soy502.com/sites/default/files/styles/escalar_image_inline/public/2025/Ago/25/naturaleza_agua_cristalina_y_fauna_en_el_ecocentro_chamche_fredy_ichich_4047267.jpg">
                                </div>
                                <button type="submit" class="btn btn-primary">Guardar Cambios (Sección 3)</button>
                            </form>
                        </div>
                    </div>
                </section>
                
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Modal para que administrador restablezca contraseña -->
    <div class="modal fade" id="adminResetModal" tabindex="-1" aria-labelledby="adminResetLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="adminResetLabel">Restablecer Contraseña (Admin)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="adminResetForm">
                        <input type="hidden" id="adminResetRequestId">
                        <div class="mb-3">
                            <label for="adminResetEmail" class="form-label">Email del Usuario</label>
                            <input type="email" class="form-control" id="adminResetEmail" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="adminNewPassword" class="form-label">Nueva Contraseña</label>
                            <input type="password" class="form-control" id="adminNewPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminNewPasswordConfirm" class="form-label">Confirmar Contraseña</label>
                            <input type="password" class="form-control" id="adminNewPasswordConfirm" required>
                        </div>
                        <div id="adminResetMessage" class="alert d-none" role="alert"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="adminSavePasswordButton">Guardar contraseña</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Calendar Management
        let currentMonth = 10; // Noviembre (0-based)
        let currentYear = 2025;
        let occupiedDays = {};

        function generateCalendarAdmin() {
            const calendar = document.getElementById('calendarAdmin');
            calendar.innerHTML = '';
            
            const days = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-admin-empty';
                calendar.appendChild(empty);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-admin-day';
                const key = `${currentYear}-${currentMonth}-${day}`;
                
                if (occupiedDays[key]) {
                    dayEl.classList.add('occupied');
                }
                
                dayEl.innerHTML = `
                    <span class="day-number">${day}</span>
                    <span class="day-status">${occupiedDays[key] ? 'Ocupado' : 'Libre'}</span>
                `;
                
                dayEl.onclick = () => toggleDay(key, dayEl);
                calendar.appendChild(dayEl);
            }
        }

        function toggleDay(key, element) {
            occupiedDays[key] = !occupiedDays[key];
            if (occupiedDays[key]) {
                element.classList.add('occupied');
                element.querySelector('.day-status').textContent = 'Ocupado';
            } else {
                element.classList.remove('occupied');
                element.querySelector('.day-status').textContent = 'Libre';
            }
        }

        function changeCalendarMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            
            const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            document.getElementById('calendarAdminTitle').textContent = `${months[currentMonth]} ${currentYear}`;
            generateCalendarAdmin();
        }

        function saveCalendar() {
            try {
                localStorage.setItem('admin_occupiedDays', JSON.stringify(occupiedDays));
                alert('Calendario guardado exitosamente');
            } catch (e) {
                console.error(e);
                alert('Error al guardar el calendario.');
            }
        }

        function resetCalendar() {
            if (confirm('¿Estás seguro de restablecer el calendario?')) {
                occupiedDays = {};
                localStorage.removeItem('admin_occupiedDays');
                generateCalendarAdmin();
            }
        }

        // Inicialización al cargar la página
        window.addEventListener('DOMContentLoaded', () => {
            // Cargar desde localStorage si existe
            try {
                const saved = localStorage.getItem('admin_occupiedDays');
                if (saved) occupiedDays = JSON.parse(saved);
            } catch (e) {
                occupiedDays = {};
            }

            const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            document.getElementById('calendarAdminTitle').textContent = `${months[currentMonth]} ${currentYear}`;
            generateCalendarAdmin();

            // Enlazar el formulario de marcar fecha para añadir directo al calendario
            const form = document.querySelector('#calendario form');
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const val = document.getElementById('fechaOcupada').value;
                    if (val) {
                        const d = new Date(val);
                        const key = `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`;
                        occupiedDays[key] = true;
                        generateCalendarAdmin();
                    }
                });
            }

            // Inicializar listado de solicitudes de restablecimiento
            try {
                renderResetRequests();
            } catch (err) {
                console.error('Error inicializando solicitudes de restablecimiento', err);
            }

            // Enlazar botón de guardar del modal admin
            const adminSavePasswordButton = document.getElementById('adminSavePasswordButton');
            if (adminSavePasswordButton) {
                adminSavePasswordButton.addEventListener('click', () => {
                    saveAdminResetPassword();
                });
            }
        });

        // --- Gestión de solicitudes de restablecimiento ---
        function getResetRequests() {
            try {
                const raw = localStorage.getItem('password_reset_requests');
                return raw ? JSON.parse(raw) : [];
            } catch (e) {
                console.error(e);
                return [];
            }
        }

        function saveResetRequests(list) {
            try {
                localStorage.setItem('password_reset_requests', JSON.stringify(list));
            } catch (e) {
                console.error(e);
            }
        }

        function renderResetRequests() {
            const container = document.getElementById('passwordResetRequestsList');
            if (!container) return;
            const list = getResetRequests();
            container.innerHTML = '';

            if (list.length === 0) {
                container.innerHTML = '<div class="text-muted">No hay solicitudes pendientes.</div>';
                return;
            }

            list.slice().reverse().forEach(req => {
                const item = document.createElement('div');
                item.className = 'list-group-item d-flex justify-content-between align-items-start';

                const left = document.createElement('div');
                left.className = 'ms-2 me-auto';
                left.innerHTML = `<div><strong>${req.email}</strong> <small class="text-muted">(${new Date(req.date).toLocaleString()})</small></div>` +
                                 `<div class="text-muted">ID: ${req.id} ${req.handled ? '<span class="badge bg-success ms-2">Atendido</span>' : ''}</div>`;

                const right = document.createElement('div');
                if (!req.handled) {
                    const btnReset = document.createElement('button');
                    btnReset.className = 'btn btn-sm btn-primary me-2';
                    btnReset.textContent = 'Restablecer';
                    btnReset.onclick = () => openAdminResetModal(req.id);
                    right.appendChild(btnReset);

                    const btnMark = document.createElement('button');
                    btnMark.className = 'btn btn-sm btn-outline-secondary';
                    btnMark.textContent = 'Marcar como atendido';
                    btnMark.onclick = () => { markRequestHandled(req.id); };
                    right.appendChild(btnMark);
                } else {
                    const span = document.createElement('span');
                    span.className = 'text-success';
                    span.textContent = 'Atendido';
                    right.appendChild(span);
                }

                item.appendChild(left);
                item.appendChild(right);
                container.appendChild(item);
            });
        }

        function openAdminResetModal(requestId) {
            const list = getResetRequests();
            const req = list.find(r => r.id === requestId);
            if (!req) return alert('Solicitud no encontrada');

            document.getElementById('adminResetRequestId').value = req.id;
            document.getElementById('adminResetEmail').value = req.email;
            document.getElementById('adminNewPassword').value = '';
            document.getElementById('adminNewPasswordConfirm').value = '';
            const msg = document.getElementById('adminResetMessage');
            msg.classList.add('d-none'); msg.textContent = '';

            const modalEl = document.getElementById('adminResetModal');
            const modal = new bootstrap.Modal(modalEl);
            modal.show();
        }

        function saveAdminResetPassword() {
            const id = Number(document.getElementById('adminResetRequestId').value);
            const email = document.getElementById('adminResetEmail').value;
            const p1 = document.getElementById('adminNewPassword').value;
            const p2 = document.getElementById('adminNewPasswordConfirm').value;
            const msg = document.getElementById('adminResetMessage');

            if (!p1 || !p2) {
                msg.className = 'alert alert-danger'; msg.textContent = 'Completa ambos campos de contraseña.'; return;
            }
            if (p1 !== p2) {
                msg.className = 'alert alert-danger'; msg.textContent = 'Las contraseñas no coinciden.'; return;
            }

            // Guardar la nueva contraseña en localStorage en un objeto 'users' (simulado)
            try {
                const raw = localStorage.getItem('users');
                const users = raw ? JSON.parse(raw) : {};
                users[email] = { password: p1, updatedAt: new Date().toISOString() };
                localStorage.setItem('users', JSON.stringify(users));

                // Marcar la solicitud como atendida
                markRequestHandled(id, false);

                msg.className = 'alert alert-success'; msg.textContent = 'Contraseña restablecida correctamente.';

                // Cerrar modal tras un momento
                setTimeout(() => {
                    const modalEl = document.getElementById('adminResetModal');
                    const modal = bootstrap.Modal.getInstance(modalEl);
                    if (modal) modal.hide();
                }, 1000);
            } catch (e) {
                console.error(e);
                msg.className = 'alert alert-danger'; msg.textContent = 'Error guardando la contraseña.';
            }
        }

        function markRequestHandled(id, rerender=true) {
            try {
                const list = getResetRequests();
                const idx = list.findIndex(r => r.id === id);
                if (idx !== -1) {
                    list[idx].handled = true;
                    list[idx].handledAt = new Date().toISOString();
                    saveResetRequests(list);
                }
                if (rerender) renderResetRequests();
            } catch (e) {
                console.error(e);
            }
        }
    </script>
    <script src="/vendedor/Direccion/controlador.js"></script>
</body>
</html>